<!DOCTYPE html>
<html>
<head>
    <title>Simple Training Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .trainer-button { background: #2196F3; }
        #log { background: #f5f5f5; padding: 10px; height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        video { width: 400px; border: 1px solid #ccc; margin: 10px 0; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; background: #fff3cd; color: #856404; }
        .trainee-interface { display: none; }
        .trainer-screen { display: none; }
    </style>
</head>
<body>
    <h1>Simple Training Integration Test</h1>
    
    <div>
        <button class="trainer-button" onclick="testTrainer()">Test as Trainer</button>
        <button onclick="testTrainee()">Test as Trainee</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="status" id="status">Ready to test...</div>
    
    <!-- Trainer interface elements -->
    <div id="trainer-interface">
        <h3>Trainer View:</h3>
        <video id="localVideo" autoplay muted></video>
    </div>
    
    <!-- Trainee interface elements -->
    <div class="trainee-interface">
        <h3>Trainee Interface (hidden when receiving)</h3>
        <p>This should be hidden when trainer screen is received</p>
    </div>
    
    <!-- Trainer screen display for trainees -->
    <div class="trainer-screen">
        <h3>Trainer Screen:</h3>
        <video id="remoteVideo" autoplay></video>
    </div>
    
    <div>
        <h3>Debug Log:</h3>
        <div id="log"></div>
    </div>

    <!-- Include the simple training screen share -->
    <script src="simpleTrainingScreenShare.js"></script>
    
    <script>
        let currentRole = null;
        
        function log(msg) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${msg}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function updateStatus(text) {
            document.getElementById('status').textContent = text;
        }
        
        // Add global debugLog function for compatibility
        window.debugLog = log;
        
        async function testTrainer() {
            if (currentRole) {
                log('Already testing as ' + currentRole);
                return;
            }
            
            currentRole = 'trainer';
            log('Testing as trainer...');
            updateStatus('Initializing trainer...');
            
            try {
                await window.simpleTrainingScreenShare.initializeTrainer();
                log('Trainer initialization complete');
                updateStatus('Trainer active - screen sharing started');
                
                // Show trainer interface
                document.getElementById('trainer-interface').style.display = 'block';
                
            } catch (error) {
                log('ERROR: ' + error.message);
                updateStatus('Trainer initialization failed');
                currentRole = null;
            }
        }
        
        async function testTrainee() {
            if (currentRole) {
                log('Already testing as ' + currentRole);
                return;
            }
            
            currentRole = 'trainee';
            log('Testing as trainee...');
            updateStatus('Initializing trainee...');
            
            try {
                await window.simpleTrainingScreenShare.initializeTrainee();
                log('Trainee initialization complete');
                updateStatus('Trainee ready - waiting for trainer...');
                
            } catch (error) {
                log('ERROR: ' + error.message);
                updateStatus('Trainee initialization failed');
                currentRole = null;
            }
        }
        
        // Override the showTrainerScreen function for testing
        if (window.simpleTrainingScreenShare) {
            const originalShowTrainerScreen = window.simpleTrainingScreenShare.showTrainerScreen;
            window.simpleTrainingScreenShare.showTrainerScreen = function() {
                log('Switching to trainer screen view');
                updateStatus('Connected - receiving trainer screen');
                
                // Hide trainee interface
                const traineeInterface = document.querySelector('.trainee-interface');
                if (traineeInterface) {
                    traineeInterface.style.display = 'none';
                }
                
                // Show trainer screen
                const trainerScreen = document.querySelector('.trainer-screen');
                if (trainerScreen) {
                    trainerScreen.style.display = 'block';
                }
                
                // Call original if it exists
                if (originalShowTrainerScreen) {
                    originalShowTrainerScreen.call(this);
                }
            };
        }
        
        log('Simple training integration test ready');
        log('Click "Test as Trainer" to start screen sharing');
        log('Click "Test as Trainee" to connect to trainer');
    </script>
</body>
</html>